<!DOCTYPE html>
<html>
<head>
  <title>Live2D</title>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    body, html {
      max-width: 100%;
      max-height: 100%;
    }
    canvas {
      max-width: 100%;
      max-height: 100%;
    }
  </style>
    <script src="static/js/live2dsdk/live2d.min.js"></script>
    <script src="static/js/live2dsdk/Live2DFramework.js"></script>
    <script src="static/js/live2dsdk/PlatformManager.js"></script>
    <script src="static/js/live2dsdk/ModelSettingJson.js"></script>
	<script src="static/js/live2dsdk/yukimiku.2d.js"></script>

  <script type="text/javascript" src="static/jszip/dist/jszip.js"></script>
  <script type="text/javascript" src="static/jszip/test/jquery-1.8.3.min.js"></script>
  <script type="text/javascript" src="static/jszip/vendor/FileSaver.js"></script>

<body onload="initModel('kr')" style="margin: 0; padding: 0;">
    <canvas id="canvas" class="maxwidth" width="500px" height="800px" style="margin: 10px;" onclick="totsugeki()"></canvas>
    <select id="modelMotions" class="select-motions" style="display: none;"></select>
    <script>
        let canvas = document.getElementById("canvas");
    </script>
    <p>Please using this js console script below.</p>
    <pre>

var shots = [];
var grabLimit = 80; // total number of capture;
var grabRate = 20; // millisecond;
var count = 0;

var childName = "c417_02" // child code name;

function sleep (delay) {
  var start = new Date().getTime();
  while (new Date().getTime() < start + delay);
}

function pad(n, width, z) {
  z = z || '0';
  n = n + '';
  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
}

function getResults() {
  var zip = new JSZip();
  for (var i = 0; i < shots.length; i++) {
    var filename = childName + "_" + pad(i, 4) + ".png";
    zip.file(filename, shots[i], {binary:true});
  }
  zip.generateAsync({type:"blob"}, function updateCallback(metadata) {
  })
  .then(function callback(blob) {
    saveAs(blob, childName + "_" + canvas.width + "_" + grabLimit + "_" + grabRate + ".zip");
  }, function (e) {
    showError(e);
  });
}

totsugeki();

var grabber = setInterval(function(){
  count++;
  if (count > grabLimit) {
    clearInterval(grabber);
    getResults();
  }

  var encodedImg = canvas.toDataURL("image/png").replace("data:image/png;base64,", "");
  var img = window.atob(encodedImg);
  shots.push(img);

}, grabRate);

    </pre>

    <p>Or using below to get high-quality images. </p>

    <pre>

var shots = [];
var grabLimit = 150; // total number of capture;
var grabRate = 20; // millisecond;
var count = 0;

var childName = "c417_02" // child code name;

var timeInterval = 4000;

function sleep (delay) {
  var start = new Date().getTime();
  while (new Date().getTime() < start + delay);
}

function pad(n, width, z) {
  z = z || '0';
  n = n + '';
  return n.length >= width ? n : new Array(width - n.length + 1).join(z) + n;
}

function getResults() {
  var zip = new JSZip();
  for (var i = 0; i < shots.length; i++) {
    var filename = childName + "_" + pad(i, 4) + ".png";
    zip.file(filename, shots[i], {binary:true});
  }
  zip.generateAsync({type:"blob"}, function updateCallback(metadata) {
  })
  .then(function callback(blob) {
    saveAs(blob, childName + "_" + canvas.width + "_" + grabLimit + "_" + grabRate + ".zip");
  }, function (e) {
    showError(e);
  });
}

var timer = [];

function getFrame() {
  totsugeki();
  setTimeout(function() {
    var encodedImg = canvas.toDataURL("image/png").replace("data:image/png;base64,", "");
    var img = window.atob(encodedImg);
    shots.push(img);
  }, count * grabRate);
  count++;
};

for (var i = 0; i <= grabLimit; i++) {
  timer.push(setTimeout(function(){getFrame();}, timeInterval * i));
};

    </pre>

  </body>

</html>
